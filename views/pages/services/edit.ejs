<div class="edit-service-page-modern">
  <div class="container">
    <!-- Modern Page Header -->
    <div class="edit-service-header-modern">
      <div class="header-content-modern">
        <div class="header-title-section">
          <a href="/services/my" class="back-btn-modern">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Back to My Services
          </a>
          <h1 class="page-title-modern">Edit Service</h1>
          <p class="page-subtitle-modern"><%= service.title %></p>
        </div>
        
        <div class="header-actions-modern">
          <div class="service-status-badge-modern <%= service.isPaused ? 'status-paused' : 'status-active' %>">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <% if (service.isPaused) { %>
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
              <% } else { %>
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
              <% } %>
            </svg>
            <%= service.isPaused ? 'Paused' : 'Active' %>
          </div>
          
          <button type="button" class="btn-toggle-status-modern" id="toggleStatusBtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <% if (service.isPaused) { %>
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              <% } else { %>
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
              <% } %>
            </svg>
            <%= service.isPaused ? 'Activate Service' : 'Pause Service' %>
          </button>
          
          <button type="button" class="btn-delete-service-modern" id="deleteServiceBtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
            Delete Service
          </button>
        </div>
      </div>
      
      <div class="service-meta-modern">
        <div class="meta-item-modern">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          <%= service.viewCount || 0 %> views
        </div>
        <div class="meta-item-modern">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          Updated <%= new Date(service.updatedAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
        </div>
      </div>
    </div>

    <% if (errors && errors.length) { %>
      <div class="alert-modern alert-error-modern">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <div class="alert-content-modern">
          <h4>Please fix the following errors:</h4>
          <ul>
            <% errors.forEach(function(error) { %>
              <li><%= error %></li>
            <% }) %>
          </ul>
        </div>
      </div>
    <% } %>

    <form id="serviceForm" action="/services/<%= service._id %>?_method=PUT" method="POST" enctype="multipart/form-data" novalidate class="edit-service-form-modern">
      <!-- Section 1: Basic Information -->
      <div class="form-section-modern">
        <div class="section-header-modern">
          <div class="section-icon-modern">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
          </div>
          <div class="section-title-group">
            <h2 class="section-title-modern">Basic Information</h2>
            <p class="section-subtitle-modern">Service title, category, and description</p>
          </div>
        </div>
        
        <div class="section-content-modern">
          <div class="form-grid-modern">
            <div class="form-group-modern full-width">
              <label class="form-label-modern" for="title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 20h9"></path>
                  <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                </svg>
                Service Title *
              </label>
              <input class="form-input-modern" type="text" id="title" name="title" required minlength="5" maxlength="100" value="<%= service.title %>" placeholder="e.g., Professional Home Cleaning Service" />
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="category">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Category *
              </label>
              <div class="select-wrapper-modern">
                <select class="form-select-modern" id="category" name="category" required>
                  <% Object.keys(categories).forEach(function(cat) { %>
                    <option value="<%= cat %>" <%= service.category === cat ? 'selected' : '' %>><%= categories[cat].label %></option>
                  <% }) %>
                </select>
                <svg class="select-arrow-modern" viewBox="0 0 12 12">
                  <path d="M3 5l3 3 3-3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="subcategory">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                Subcategory
              </label>
              <div class="select-wrapper-modern">
                <select class="form-select-modern" id="subcategory" name="subcategory" data-value="<%= service.subcategory || '' %>">
                  <option value="">Select subcategory</option>
                  <!-- Populated by JS -->
                </select>
                <svg class="select-arrow-modern" viewBox="0 0 12 12">
                  <path d="M3 5l3 3 3-3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>
            
            <div class="form-group-modern full-width">
              <label class="form-label-modern" for="description">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="17" y1="10" x2="3" y2="10"></line>
                  <line x1="21" y1="6" x2="3" y2="6"></line>
                  <line x1="21" y1="14" x2="3" y2="14"></line>
                  <line x1="17" y1="18" x2="3" y2="18"></line>
                </svg>
                Description *
              </label>
              <textarea class="form-textarea-modern" id="description" name="description" required minlength="50" maxlength="2000" rows="5" placeholder="Describe your service in detail..."><%= service.description %></textarea>
              <div class="character-counter-modern">
                <span id="descCounter">0</span>/2000
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Section 2: Pricing -->
      <div class="form-section-modern">
        <div class="section-header-modern">
          <div class="section-icon-modern">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
          </div>
          <div class="section-title-group">
            <h2 class="section-title-modern">Pricing & Charges</h2>
            <p class="section-subtitle-modern">Set your pricing model and additional fees</p>
          </div>
        </div>
        
        <div class="section-content-modern">
          <div class="pricing-type-selector-modern">
            <label class="form-label-modern">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path>
                <path d="M12 18V6"></path>
              </svg>
              Pricing Type *
            </label>
            <div class="pricing-cards-grid-modern">
              <% pricingTypes.forEach(function(type) { %>
                <label class="pricing-card-modern">
                  <input type="radio" name="pricingType" value="<%= type %>" <%= service.pricingType === type ? 'checked' : '' %> required />
                  <div class="pricing-card-content-modern">
                    <div class="pricing-card-icon-modern">
                      <% if (type === 'Hourly') { %>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <circle cx="12" cy="12" r="10"></circle>
                          <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                      <% } else if (type === 'Fixed') { %>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                          <line x1="7" y1="7" x2="7.01" y2="7"></line>
                        </svg>
                      <% } else { %>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                          <circle cx="12" cy="7" r="4"></circle>
                          <line x1="2" y1="8" x2="6" y2="12"></line>
                          <line x1="6" y1="8" x2="2" y2="12"></line>
                          <line x1="22" y1="8" x2="18" y2="12"></line>
                          <line x1="18" y1="8" x2="22" y2="12"></line>
                        </svg>
                      <% } %>
                    </div>
                    <span class="pricing-card-label-modern"><%= type %></span>
                  </div>
                </label>
              <% }) %>
            </div>
          </div>
          
          <div class="form-grid-modern">
            <div class="form-group-modern">
              <label class="form-label-modern" for="basePrice">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="1" x2="12" y2="23"></line>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                Base Price (₹) *
              </label>
              <input class="form-input-modern" type="number" id="basePrice" name="basePrice" min="0" max="100000" required value="<%= service.basePrice %>" placeholder="500" />
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="advancePercentage">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="19" y1="5" x2="5" y2="19"></line>
                  <circle cx="6.5" cy="6.5" r="2.5"></circle>
                  <circle cx="17.5" cy="17.5" r="2.5"></circle>
                </svg>
                Advance Payment %
              </label>
              <input class="form-input-modern" type="number" id="advancePercentage" name="advancePercentage" min="0" max="50" value="<%= service.advancePercentage %>" placeholder="20" />
              <div class="form-helper-text-modern">Percentage of advance payment required</div>
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="travelFee">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="1" y="3" width="15" height="13"></rect>
                  <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                  <circle cx="5.5" cy="18.5" r="2.5"></circle>
                  <circle cx="18.5" cy="18.5" r="2.5"></circle>
                </svg>
                Travel Fee (₹)
              </label>
              <input class="form-input-modern" type="number" id="travelFee" name="travelFee" min="0" max="5000" value="<%= service.travelFee %>" placeholder="100" />
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="weekendPremium">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                Weekend Premium %
              </label>
              <input class="form-input-modern" type="number" id="weekendPremium" name="weekendPremium" min="0" max="15" value="<%= service.weekendPremium %>" placeholder="10" />
              <div class="form-helper-text-modern">Additional charge for weekends</div>
            </div>
          </div>
          
          <div id="packageSection" class="package-section-modern" style="display:none;">
            <div class="package-builder-modern">
              <label class="form-label-modern">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                  <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                  <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                  <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
                Package Details
              </label>
              <div id="packageList" class="package-list-modern"></div>
              <button type="button" class="btn-add-package-modern" id="addPackageBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Package
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Section 3: Service Mode & Location -->
      <div class="form-section-modern">
        <div class="section-header-modern">
          <div class="section-icon-modern">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
          </div>
          <div class="section-title-group">
            <h2 class="section-title-modern">Service Mode & Location</h2>
            <p class="section-subtitle-modern">Where and how you provide your service</p>
          </div>
        </div>
        
        <div class="section-content-modern">
          <div class="mode-selector-modern">
            <label class="form-label-modern">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
              </svg>
              Service Mode *
            </label>
            <div class="mode-cards-grid-modern">
              <% modes.forEach(function(mode) { %>
                <label class="mode-card-modern">
                  <input type="radio" name="mode" value="<%= mode %>" <%= service.mode === mode ? 'checked' : '' %> required />
                  <div class="mode-card-content-modern">
                    <div class="mode-card-icon-modern">
                      <% if (mode === 'Online') { %>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <circle cx="12" cy="12" r="10"></circle>
                          <circle cx="12" cy="12" r="6"></circle>
                          <circle cx="12" cy="12" r="2"></circle>
                        </svg>
                      <% } else if (mode === 'Offline') { %>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                          <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                      <% } else { %>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="16 18 22 12 16 6"></polyline>
                          <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                      <% } %>
                    </div>
                    <span class="mode-card-label-modern"><%= mode %></span>
                  </div>
                </label>
              <% }) %>
            </div>
          </div>
          
          <div class="form-grid-modern">
            <div class="form-group-modern">
              <label class="form-label-modern" for="city">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                  <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                City *
              </label>
              <input class="form-input-modern" type="text" id="city" name="city" required minlength="2" maxlength="50" value="<%= service.city %>" placeholder="e.g., Mumbai" />
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="pincode">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                Pincode *
              </label>
              <input class="form-input-modern" type="text" id="pincode" name="pincode" required pattern="\d{6}" maxlength="6" value="<%= service.pincode %>" placeholder="400001" />
            </div>
          </div>
        </div>
      </div>
      <!-- Section 4: Availability -->
      <div class="form-section-modern">
        <div class="section-header-modern">
          <div class="section-icon-modern">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </div>
          <div class="section-title-group">
            <h2 class="section-title-modern">Availability & Schedule</h2>
            <p class="section-subtitle-modern">Set your working hours and booking limits</p>
          </div>
        </div>
        
        <div class="section-content-modern">
          <div class="availability-builder-modern" id="availabilityBuilder"></div>
          
          <div class="form-grid-modern">
            <div class="form-group-modern">
              <label class="form-label-modern" for="maxBookingsPerDay">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                Max Bookings Per Day
              </label>
              <input class="form-input-modern" type="number" id="maxBookingsPerDay" name="maxBookingsPerDay" min="1" max="20" value="<%= service.maxBookingsPerDay %>" placeholder="5" />
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="advanceBookingLimit">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                  <path d="M8 14h.01"></path>
                  <path d="M12 14h.01"></path>
                  <path d="M16 14h.01"></path>
                  <path d="M8 18h.01"></path>
                  <path d="M12 18h.01"></path>
                  <path d="M16 18h.01"></path>
                </svg>
                Advance Booking Limit (days)
              </label>
              <input class="form-input-modern" type="number" id="advanceBookingLimit" name="advanceBookingLimit" min="1" max="365" value="<%= service.advanceBookingLimit %>" placeholder="30" />
              <div class="form-helper-text-modern">Days in advance customers can book</div>
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="preparationTime">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                Preparation Time (hours)
              </label>
              <input class="form-input-modern" type="number" id="preparationTime" name="preparationTime" min="0" max="48" value="<%= service.preparationTime %>" placeholder="2" />
              <div class="form-helper-text-modern">Hours needed between bookings</div>
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="unavailableDates">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                  <line x1="8" y1="14" x2="16" y2="14"></line>
                </svg>
                Unavailable Dates
              </label>
              <input class="form-input-modern" type="date" id="unavailableDates" name="unavailableDates" multiple />
            </div>
          </div>
        </div>
      </div>
      <!-- Section 5: Additional Details -->
      <div class="form-section-modern">
        <div class="section-header-modern">
          <div class="section-icon-modern">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
          </div>
          <div class="section-title-group">
            <h2 class="section-title-modern">Additional Details</h2>
            <p class="section-subtitle-modern">Extra information about your service</p>
          </div>
        </div>
        
        <div class="section-content-modern">
          <div class="form-grid-modern">
            <div class="form-group-modern">
              <label class="form-label-modern" for="languages">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                  <path d="M2 12h20"></path>
                </svg>
                Languages
              </label>
              <input class="form-input-modern" type="text" id="languages" name="languages" value="<%= service.languages ? service.languages.join(', ') : '' %>" placeholder="English, Hindi, Marathi" />
            </div>
            
            <div class="form-group-modern">
              <label class="form-label-modern" for="experienceYears">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                  <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
                Experience Years
              </label>
              <input class="form-input-modern" type="number" id="experienceYears" name="experienceYears" min="0" max="50" value="<%= service.experienceYears %>" placeholder="5" />
            </div>
            
            <div class="form-group-modern full-width">
              <label class="form-label-modern" for="certifications">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="9" y1="13" x2="15" y2="13"></line>
                  <line x1="9" y1="17" x2="15" y2="17"></line>
                </svg>
                Certifications
              </label>
              <textarea class="form-textarea-modern" id="certifications" name="certifications" rows="3" placeholder="List your certifications, comma separated"><%= service.certifications ? service.certifications.join(', ') : '' %></textarea>
            </div>
            
            <div class="form-group-modern full-width">
              <label class="form-label-modern" for="cancellationPolicy">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M4.93 4.93l14.14 14.14"></path>
                </svg>
                Cancellation Policy
              </label>
              <textarea class="form-textarea-modern" id="cancellationPolicy" name="cancellationPolicy" maxlength="500" rows="3" placeholder="Describe your cancellation policy..."><%= service.cancellationPolicy %></textarea>
              <div class="character-counter-modern">
                <span id="cancelCounter"><%= service.cancellationPolicy ? service.cancellationPolicy.length : 0 %></span>/500
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Section 6: Service Images -->
      <div class="form-section-modern">
        <div class="section-header-modern">
          <div class="section-icon-modern">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <circle cx="8.5" cy="8.5" r="1.5"></circle>
              <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
          </div>
          <div class="section-title-group">
            <h2 class="section-title-modern">Service Images</h2>
            <p class="section-subtitle-modern">Upload photos showcasing your service (<span id="imageCount"><%= service.images ? service.images.length : 0 %></span>/5)</p>
          </div>
        </div>
        
        <div class="section-content-modern">
          <div class="image-gallery-modern">
            <div class="image-preview-grid-modern" id="imagePreviewGrid">
              <% if (service.images && service.images.length) { %>
                <% service.images.forEach(function(img, idx) { %>
                  <div class="image-preview-item-modern" data-index="<%= idx %>">
                    <img class="image-preview-img-modern" src="<%= img %>" alt="Service Image <%= idx+1 %>" />
                    <div class="image-overlay-modern">
                      <button type="button" class="image-remove-btn-modern" data-index="<%= idx %>">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="3 6 5 6 21 6"></polyline>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Remove
                      </button>
                    </div>
                    <% if (idx === 0) { %>
                      <div class="image-primary-badge-modern">Primary</div>
                    <% } %>
                  </div>
                <% }) %>
              <% } %>
              
              <% if (!service.images || service.images.length < 5) { %>
                <label class="image-upload-card-modern" for="serviceImages">
                  <input type="file" id="serviceImages" name="serviceImages" accept="image/jpeg,image/png,image/webp" multiple style="display:none;" />
                  <div class="upload-icon-modern">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="17 8 12 3 7 8"></polyline>
                      <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                  </div>
                  <span class="upload-text-modern">Upload Images</span>
                  <span class="upload-subtext-modern">Max 5MB each • JPEG, PNG, WebP</span>
                </label>
              <% } %>
            </div>
          </div>
          <input type="hidden" id="deleteImages" name="deleteImages" value="" />
        </div>
      </div>
      
      <!-- Hidden inputs for JSON serialization -->
      <input type="hidden" id="weeklySchedule" name="weeklySchedule" />
      <input type="hidden" id="packages" name="packages" />
      
      <!-- Form Actions -->
      <div class="form-actions-modern">
        <button type="submit" class="btn-save-modern" id="submitBtn">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          Save Changes
        </button>
        
        <a href="/services/my" class="btn-cancel-modern">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
          Cancel
        </a>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal-modern" style="display:none;">
  <div class="modal-overlay-modern"></div>
  <div class="modal-content-modern">
    <div class="modal-header-modern">
      <h3 class="modal-title-modern">Delete Service?</h3>
      <button type="button" class="modal-close-modern" onclick="document.getElementById('deleteModal').style.display='none'">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="modal-body-modern">
      <p>Are you sure you want to delete "<strong><%= service.title %></strong>"? This action cannot be undone.</p>
    </div>
    <div class="modal-actions-modern">
      <button type="button" class="btn-modal-cancel-modern" onclick="document.getElementById('deleteModal').style.display='none'">Cancel</button>
      <form action="/services/<%= service._id %>?_method=DELETE" method="POST" style="display:inline;">
        <button type="submit" class="btn-modal-confirm-modern">Delete Service</button>
      </form>
    </div>
  </div>
</div>
<script>
  // Embed SERVICE_CATEGORIES for client-side use
  window.SERVICE_CATEGORIES = <%- JSON.stringify(categories) %>;
  // Pass existing data to JS
  const serviceForm = document.getElementById('serviceForm');
  if (serviceForm) {
    serviceForm.dataset.subcategory = '<%= service.subcategory || "" %>';
    serviceForm.dataset.packages = '<%- service.packages ? JSON.stringify(service.packages) : "[]" %>';
    serviceForm.dataset.schedule = '<%- service.weeklySchedule ? JSON.stringify(service.weeklySchedule) : "[]" %>';
  }
</script>
<script src="/js/service-form.js"></script>
